<!--
 * ========================================================================
 * FICHEIRO: frontend/src/app/pages/processes/process-report/process-report.component.html
 * ========================================================================
 * A correção final está no bloco <style> e na estrutura do cabeçalho
 * para garantir um posicionamento perfeito na impressão.
-->

<style>
  @page {
    size: A4;
    margin: 2cm; /* Margem da página para impressão */
  }
  @media print {
    .no-print {
      display: none !important;
    }
    body,
    .container {
      margin: 0;
      padding: 0;
      width: 100% !important;
      max-width: 100% !important;
      box-shadow: none !important;
      border: none !important;
    }
    /* A correção está aqui: removemos o padding do report-content e controlamos tudo com @page */
    .report-content {
      border: none !important;
      box-shadow: none !important;
      padding: 0 !important;
      font-family: "Times New Roman", serif;
      font-size: 12pt;
    }
    .report-content p.body-p {
      text-indent: 3.5em;
      line-height: 1.5;
      text-align: justify;
      margin-bottom: 1rem;
    }
    .header-p {
      text-indent: 0 !important;
      margin-bottom: 0 !important;
    }
    .footer-quote {
      text-indent: 0 !important;
      margin-bottom: 0 !important;
      font-size: 10pt;
    }
    .footer-signature {
      text-indent: 0 !important;
      font-size: 8pt;
    }
  }
  .document-body {
    line-height: 1.5;
    text-align: justify;
  }
  .signature-block {
    text-align: center;
    margin-top: 40px;
  }
  .signature-line {
    border-top: 1px solid #000;
    width: 400px;
    margin: 0 auto;
  }
</style>

<div class="container mt-4 mb-4">
  <!-- Barra de Ações (não será impressa) -->
  <div
    class="d-flex justify-content-between align-items-center mb-4 p-3 rounded bg-light border no-print"
  >
    <div>
      <label for="templateSelector" class="form-label me-2"
        >Selecione o Modelo:</label
      >
      <select
        id="templateSelector"
        class="form-select d-inline-block w-auto"
        [(ngModel)]="selectedTemplate"
      >
        <option value="relatorio_geral">Relatório Geral</option>
        <option value="notificacao_oficio">
          Ofício de Notificação (Defesa Prévia)
        </option>
        <option value="relatorio_final">Relatório Final</option>
      </select>
    </div>
    <div>
      <button class="btn btn-primary me-2" (click)="printPage()">
        Imprimir / Guardar como PDF
      </button>
      <a
        *ngIf="process"
        [routerLink]="['/processes', process.id]"
        class="btn btn-secondary"
        >Voltar aos Detalhes</a
      >
    </div>
  </div>

  <!-- Conteúdo do Relatório -->
  <div
    *ngIf="!isLoading && process"
    class="bg-white p-5 border shadow-sm report-content"
  >
    <div [ngSwitch]="selectedTemplate">
      <!-- ================== MODELO: OFÍCIO DE NOTIFICAÇÃO (CORRIGIDO) ================== -->
      <div *ngSwitchCase="'notificacao_oficio'">
        <div style="text-align: center; font-size: 10pt">
          <p class="header-p"><strong>MINISTÉRIO DA DEFESA</strong></p>
          <p class="header-p"><strong>EXÉRCITO BRASILEIRO</strong></p>
          <p class="header-p">
            <strong>BASE DE APOIO REGIONAL DE SOROCABA</strong>
          </p>
          <p class="header-p">
            <small>(14ª Circunscrição de Recrutamento/1946)</small>
          </p>
        </div>

        <hr />

        <table style="width: 100%; border: none; font-size: 12pt">
          <tbody>
            <tr>
              <td>
                <p class="header-p">Ofício nº [Número do Ofício]/SFPC/Cmdo</p>
                <p class="header-p">EB: {{ process.process_number }}</p>
              </td>
              <td style="text-align: right">
                <p class="header-p">
                  Sorocaba, SP,
                  {{ currentDate | date : "d 'de' MMMM 'de' y" : "pt-BR" }}.
                </p>
              </td>
            </tr>
          </tbody>
        </table>

        <div class="mt-4">
          <p class="header-p">
            <strong>{{ process.interested_party | uppercase }}</strong>
          </p>
          <p class="header-p">ADMINISTRADO SFPC/48</p>
          <p class="header-p">[Endereço do Administrado]</p>
          <p class="header-p">[CEP] - [Cidade]-[UF]</p>
        </div>

        <p class="mt-3 header-p">
          <strong>Assunto:</strong> Notificação {{ process.interested_party }} -
          CR {{ process.cr }}
        </p>

        <hr />

        <main class="mt-3 document-body">
          <p class="body-p">
            1. Informo que essa Administração Militar tomou conhecimento por
            meio do Clube de Tiro [Nome do Clube de Tiro] que Vossa Senhoria foi
            desassociado do mesmo, dessa forma, foi formalizado o seu
            desligamento e protocolado nesta OM.
          </p>
          <p class="body-p">
            2. Nesse sentido e obedecendo ao que estabelece o inciso III, letra
            B, Art. 17, da Portaria 166 COLOG de 22 de dezembro de 2023, é
            condição obrigatória para manutenção do registro para o trato com o
            Produto Controlado pelo Exército a filiação a entidade de tiro/caça,
            sendo assim, informo que o registro será
            <strong>SUSPENSO TEMPORARIAMENTE</strong>, tendo em vista o presente
            estar em desacordo com a autorização concedida anteriormente e
            caracterizar infração.
          </p>
          <p class="body-p">
            3. Pelo exposto, <strong>NOTIFICO</strong> esse administrado para
            que apresente defesa prévia, por escrito, se assim o desejar, no
            prazo de <strong>quinze dias</strong>, concedendo, assim, o direito
            à ampla defesa e ao contraditório.
          </p>
          <p class="body-p">
            4. Outrossim, informo que a defesa escrita deverá ser dirigida ao
            Comandante da Base de Apoio Regional de Sorocaba e remetida ou
            entregue na Avenida Roberto Simonsen, n° 150, Bairro Santa Rosália -
            Sorocaba/São Paulo, ou através de e-mail.
          </p>
          <p class="body-p">
            Por ordem do Comandante da 2ª região militar publicado no B Esp n°
            002, de 2 ABRIL 24.
          </p>
          <div class="signature-block">
            <div class="signature-line"></div>
            <p class="mb-0 mt-2">
              <strong>CARLOS ROBERTO DE JESUS JUNIOR - Tenente Coronel</strong>
            </p>
            <p>Chefe da Seção de Fiscalização de Produtos Controlados</p>
          </div>
        </main>

        <footer class="mt-5">
          <p class="text-center footer-quote">
            "200 ANOS DO TENENTE ANTÔNIO JOÃO: HERÓI DA EPOPEIA DE DOURADOS"
          </p>
          <hr />
        </footer>
      </div>

      <!-- Outros modelos -->
      <div *ngSwitchCase="'relatorio_geral'">...</div>
      <div *ngSwitchCase="'relatorio_final'">...</div>
    </div>
  </div>
</div>
